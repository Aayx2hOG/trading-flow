generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          String       @id @default(cuid())
  email       String       @unique
  username    String       @unique
  password    String?
  githubId    String?      @unique
  googleId    String?      @unique
  workflows   Workflow[]
  credentials Credential[]
}

model Workflow {
  id          String      @id @default(cuid())
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String
  name        String      @default("untitled workflow")
  description String?
  nodes       Json        @default("[]")
  edges       Json        @default("[]")
  executions  Execution[]
  webhookUrl  String?     @unique
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([userId])
}

enum ExecutionStatus {
  SUCCESS
  FAILURE
}

model Execution {
  id         String          @id @default(cuid())
  workflowId String
  workflow   Workflow        @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  status     ExecutionStatus
  startTime  DateTime        @default(now())
  endTime    DateTime?

  @@index([workflowId])
  @@index([status])
}

model Credential {
  id            String   @id @default(uuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name          String
  type          String
  encryptedData String
  iv            String
  authTag       String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
